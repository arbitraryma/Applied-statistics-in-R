---
title: "Tutotial 2 Basic plotting and ggplot2"
author: "Ziling Ma"
date: "Sep 15th, 2024"
output:
  html_document:
    toc: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# BASIC PLOTTING
One particularly popular feature of R is its incredibly flexible plotting tools for
data and model visualization. This is what draws many to R in the first place. Mastering
R’s graphical functionality does require practice, but the fundamental concepts are straightforward. 

## Using plot
The easiest way to think about generating plots in R is to treat your screen as a blank, two-dimensional canvas. You can plot points and lines using x- and y-coordinates. 

For this section, we will use the two vectors foo and bar as follows.
```{r}
foo <- c(1.1,2,3.5,3.9,4.2)
bar <- c(2,2.2,-1.3,0,0.2)
```

Let's first try to plot these two vectors (foo in x-axis, bar in y-axis) using the function plot().

```{r}
plot(foo,bar)
```

The x and y locations don’t necessarily need to be specified as separate vectors. You can also supply coordinates in the form of a matrix, with the x values in the first column and the y values in the second column, or as a list. For example,
```{r}
baz <- cbind(foo,bar)
baz
```
```{r}
plot(baz)
```

## Graphical parameters
<span style="color:blue"> Automatic Plot Types</span>

By default, the plot function will plot individual points.

Now, if we would like to show lines connecting each coordinate, how to do that?

```{r}
plot(foo,bar,type="l")
```

<span style="color:blue"> Title and Axis Labels </span>

By default, a basic plot won’t have a main title, and its axes will be labeled with the names of the vectors being plotted.
But a main title and more descriptive axis labels often make the plotted data easier to interpret. You can add these by supplying text as character strings to main for a title, xlab for the x-axis label, and ylab for the y-axis label.

Please add set the title name as 'My lovely plot', x-axis label as "x axis label", y-axis label as "location y".

```{r}
plot(foo,bar,type="l",main="My lovely plot",xlab="x axis label",ylab="location y")
```

What can you do if you want to have two lines of the main title, please try to write the main title as 'My lovely plot title on two lines'
where we put 'title on two lines' in the second row 

```{r}
plot(foo,bar,type="b",main="My lovely plot \n title on two lines",xlab="",  ylab="")
```

<span style="color:blue"> Color </span>

Adding color to a graph is far from just an aesthetic consideration. Color can make data much clearer—for example by distinguishing factor levels or emphasizing important numeric limits.

So, now, please adapt the code below and change the color to red.
```{r}
plot(foo,bar,type="b",main="My lovely plot",xlab="",ylab="",col='red')
# plot(foo,bar,type="b",main="My lovely plot",xlab="",ylab="",col=2)
```


<span style="color:blue"> Line and Point Appearances </span>

To alter the appearance of the plotted points you would use pch, and to alter the lines you would use lty.

The pch parameter controls the character used to plot individual data points. You can specify a single character to use for each point, or you can specify a value between 1 and 25 (inclusive).

The lty parameter, which affects the type of line drawn, can take the values 1 through 6. For example, 

```{r}
plot(foo,bar,type="b",main="My lovely plot",xlab="",ylab="",
        col=4,pch=8,lty=2,cex=2.3,lwd=3.3)
```


## Exercise 
With the following data, create a plot of weight on the x-axis and height on the y-axis. Use different point characters or colors to distinguish between males and females and provide a matching legend. Label the axes and give the plot a title.

```{r}
weight <- c(55,85,75,42,93,63,58,75,89,67)
height <- c(161, 185, 174, 154, 188, 178, 170, 167, 181, 178)
sex <- c("female", "male", "male", "female", "male", "male", "female", "male", "male", "female")
```
Hint: To create a basic plot in R using the given data, you can use the plot() function, differentiating between males and females by using different point characters (pch) or colors.

```{r}
# Create a vector for point characters based on sex
pch_values <- ifelse(sex == "male", 16, 17) # 16 for males, 17 for females

# Create the plot
plot(weight, height, 
     pch = pch_values, # Use different point characters
     col = ifelse(sex == "male", "cyan4", "lightpink3"), # Color male blue and female red
     xlab = "Weight (kg)", 
     ylab = "Height (cm)", 
     main = "Weight vs Height by Sex")

# Add a legend
legend("topleft", legend = c("Male", "Female"), pch = c(16, 17), col = c("cyan4", "lightpink3"))
```


# Introduction to ggplot2

`ggplot2` is a powerful data visualization library in R that provides a flexible and intuitive way to create high-quality graphics. It is based on the Grammar of Graphics, which allows you to build complex plots by combining simple components.

In this tutorial, we'll cover the basic usage of `ggplot2` and explore various plotting functions and options.

```{r}
library(ggplot2)
```

## A quick plot with qplot
qplot() is a function in the ggplot2 package in R. It stands for "quick plot" and is designed to provide a simpler, more concise way to create plots using the powerful ggplot2 system. It allows users to create common types of plots quickly without the need to write more complex ggplot code.

a. We will use the foo and bar vectors again. First, let us visualize the data use function 'qplot'.

```{r}
qplot(foo,bar)
```

You can add a title and axis labels also using the same arguments you already saw with 'plot' before.

```{r}
qplot(foo,bar,main="My lovely qplot",xlab="x axis label",ylab="location y")
```

<span style="color:blue"> Setting Appearance Constants with Geoms </span>

To add and customize points and lines in a ggplot2 graphic, you alter the object itself, rather than using a long list of arguments or secondary func- tions executed separately (such as points or lines). You can modify the object using ggplot2’s convenient suite of geometric modifiers, known as geoms.

Now please try to follow the instructions as follows. 

a. In the first call to qplot, you create an empty plot object by setting the initial geometric modifier as 'geom="blank"' (if you displayed this plot, you would just see the gray background and the axes).

b. Then you layer on the two other geoms as geom_point() and geom_line(). As indicated by the parentheses, these geoms are functions that result in their own specialized objects. You can add geoms to the qplot object using the + operator. Please speicy the point to have size 3, shape 6, and color to be blue. The line to be red and with 'linetype' 2. 

```{r}
qplot(foo,bar,geom="blank") + geom_point(size=3,shape=6,color="blue") +
      geom_line(color="red",linetype=2)
```

## Scatter Plot

Let's take a look at a simple scatter plot. We'll use the built-in `mtcars` dataset to plot the relationship between the horsepower and the miles per gallon (mpg) of cars.

```{r}
library(ggplot2)
# Load the mtcars dataset
data(mtcars)
# Create a scatter plot
ggplot(mtcars, aes(x = hp, y = mpg, color = "red")) +
  geom_point()
```

## Line Plot

Next, let's create a line plot to visualize the trend of a variable over time. We'll use the built-in `economics` dataset to plot the relationship between the date and the unemployement rate.

```{r}
# Load the economics dataset
data(economics)

# Create a line plot
ggplot(economics, aes(x = date, y = unemploy)) +
    geom_point() +
  geom_line()
```

## Bar Plot

Bar plots are useful for comparing categorical variables. Let's create a bar plot to compare the average miles per gallon (mpg) of different car engines.

```{r}
# Calculate the average mpg by car engine type
mpg_avg <- aggregate(mpg ~ vs, data = mtcars, FUN = mean)

# Create a bar plot
ggplot(mpg_avg, aes(x = vs, y = mpg)) +
  geom_bar(stat = "identity")

# In the geom_bar() function, the stat = "identity" argument tells ggplot to use the actual values provided in the dataset, instead of counting occurrences or performing other statistical transformations.
```

## Box Plot

Box plots are commonly used to visualize the distribution of a variable across different groups. Let's create a box plot to compare the horsepower of cars by the number of cylinders.

```{r}
# Create a box plot
ggplot(mtcars, aes(x = as.factor(cyl), y = hp)) +
  geom_boxplot() +
  ggtitle("Comparison of horsepower of cars by the number of cylinders") +
  xlab("Number of cylinders") +
  ylab("Gross horsepower")
```

## Histogram

Histograms are used to visualize the distribution of a continuous variable. Let's create a histogram to examine the distribution of car weights in the `mtcars` dataset.

```{r}
# Create a histogram
ggplot(mtcars, aes(x = wt)) +
  geom_histogram(bins = 20)
```

## Scatter Plot with Regression Line

We can add a regression line to a scatter plot to visualize the relationship between two variables. Let's create a scatter plot of car weights versus horsepower and add a regression line.

```{r}
# Create a scatter plot with regression line
ggplot(mtcars, aes(x = wt, y = hp)) +
  geom_point() +
  geom_smooth(method = "lm")
```

## Customizing Plot Appearance

`ggplot2` provides extensive options for customizing the appearance of plots. Let's create a scatter plot of car weights versus horsepower and customize the colors, labels, and axis limits.

```{r}
# Create a scatter plot with customized appearance
ggplot(mtcars, aes(x = wt, y = hp, shape = as.factor(vs), color = drat, size = mpg)) +
  geom_point() +
  labs(title = "Car Weights vs. Horsepower",
       x = "Weight",
       y = "Horsepower") +
  xlim(1.5, 6) +
  ylim(50, 350)
```

## Faceted Plots

Faceting allows you to create multiple plots based on the levels of a categorical variable. Let's create a faceted scatter plot to compare the horsepower and miles per gallon (mpg) of cars for different car transmissions.

```{r}
library(ggplot2)

# Load the mtcars dataset
data(mtcars)

# Create a faceted scatter plot
ggplot(mtcars, aes(x = hp, y = mpg)) +
  geom_point() +
  facet_wrap(vars(am))
# The vars() function in this context is used to specify variables in a tidy way within the ggplot2 framework, especially for faceting and other operations. 
```

## Adding Smoothed Lines

We can add smoothed lines to scatter plots to visualize the trend between two variables. Let's create a scatter plot of car weights versus horsepower and add smoothed lines using different smoothing methods.

```{r}
# Create a scatter plot with smoothed lines
ggplot(mtcars, aes(x = wt, y = hp)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  geom_smooth(method = "loess", se = FALSE, color = "blue")
```

## Layering Multiple Geometries

`ggplot2` allows you to layer multiple geometries to create more complex plots. Let's create a scatter plot with points and error bars to visualize the mean and standard deviation of the horsepower for different number of forward gears.

```{r}
# Calculate the mean and standard deviation of horsepower by Number of forward gears
hp_stats <- aggregate(hp ~ gear, data = mtcars, FUN = mean)
hp_stats$sd <- aggregate(hp ~ gear, data = mtcars, FUN = sd)$hp
colnames(hp_stats) <- c("gear", "mean", "sd")

# Create a scatter plot with points and error bars
ggplot(hp_stats, aes(x = gear, y = mean)) +
  geom_point() +
  geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.2) +
  geom_line() +
  geom_smooth(method = "loess", se = TRUE, color = "blue")
```

## Customizing Themes

`ggplot2` provides various themes to customize the appearance of your plots. Let's create a scatter plot of car weights versus horsepower and apply a customized theme.

```{r}
# Create a scatter plot with a customized theme
ggplot(mtcars, aes(x = wt, y = hp)) +
  geom_point()
ggplot(mtcars, aes(x = wt, y = hp, shape = as.factor(vs))) +
  geom_point() +
  theme_classic() +
  theme(legend.position = "none") +
  ggtitle("Blablabla") +
  xlab("Weight") + ylab("Gross horsepower") +
  labs(subtitle = "Subtitle")
  
```


## Customizing Legends

Legends provide information about the mapping between data and aesthetics in a plot. Let's create a scatter plot of car weights versus horsepower and customize the legend title, labels, and position.

```{r}
# Create a scatter plot with a customized legend
library(mapproj)
ggplot(mtcars, aes(x = wt, y = hp, color = factor(cyl), shape = factor(am), size = mpg)) +
  geom_point() +
  labs(color = "Cylinders", shape = "Transmission") +
  scale_color_manual(values = c("black", "brown", "purple"),
                     labels = c("4 Cyl", "6 Cyl", "8 Cyl")) +
  scale_shape_manual(values = c(1, 13),
                     labels = c("Automatic", "Manual")) +
  scale_size_continuous(breaks = c(15, 21, 26, 30)) +
  theme(legend.position = "left") +
  ggtitle("Something") + xlab("Weight") + ylab("Gross horsepower")
```

## Proportional Symbol Map

A proportional symbol map is used to represent spatial distributions by varying the size of symbols based on the values associated with the locations. Let's create a proportional symbol map of cities in the United States, where the size of the circles represents the population.

```{r}
library(maps)
library(dplyr)
# Load the city data
data(us.cities)
# Get the map data for the US
us_map <- map_data("state")
# Create a proportional symbol map
ggplot() +
  geom_polygon(data = us_map, aes(x = long, y = lat, group = group), fill = "white", color = "blue") +
  geom_point(data = us.cities, aes(x = long, y = lat, size = pop), color = "red", alpha = 0.5) +
  scale_size(range = c(1, 10)) +
  coord_map() +
  theme_void()
```

## Bubble Map

A bubble map is similar to a proportional symbol map but uses bubbles of different sizes to represent quantities associated with specific locations. Let's create a bubble map of countries based on their GDP.

```{r}
library(maps)
# Load the country data
data(world.cities)
world_map <- map_data("world")

# Create a bubble map
ggplot() +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), fill = "lightgray", color = "black") +
  geom_point(data = world.cities, aes(x = long, y = lat, color = pop, size = pop), alpha = 0.1) +
  scale_size(range = c(1, 10)) +
  scale_color_viridis_c() +
  coord_cartesian(xlim = c(-180, 180), ylim = c(-90, 90)) +
  theme_void() +
  labs(color = "Population", size = "Population")
```

